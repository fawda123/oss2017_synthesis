---
title: "Merge Habitat Restoration Projects with BMP-Treatment Type Projects"
author: "Ed Sherwood"
date: "July 19, 2017"
output: html_document
---
```{r message = F, warning = F, results = 'hide'}
library(tidyverse)
library(readxl)
library(ggmap)
library(lubridate)
library(geosphere)
library(stringi)
library(tibble)
knitr::knit('project_merge.Rmd', tangle = TRUE)
file.copy('project_merge.R', 'R/project_merge.R')
file.remove('project_merge.R')
```

```{r warning = F, message = F, fig.width = 8, fig.height = 6}  
wat_tr <- 'data-raw/apdb_completed_categorized.csv'

# clean up habitat restoration data
watdat <- wat_tr %>% 
  read_csv %>% 
  rename(
    id = Unique_Project_ID
    lat = ProjectLatitude, 
    lon = ProjectLongitude, 
    date = Completion_Date, 
    tech = Project_Technology, 
    type = Project_Activity, 
    acre = Acres
  ) %>% 
  mutate(
    id = stri_rand_strings(nrow(.), length = 4),
    lat = as.numeric(lat),
    lon = as.numeric(lon),
    date = as.numeric(date),
    tech = toupper(tech)
  ) %>% 
  filter(lat > 27.3 & lat < 28.2) %>% 
  filter(!is.na(date))

# habitat restoration station locs
habstat <- habdat %>% 
  select(id, lat, lon) %>% 
  unique

# normalized habitat data
habdat <- habdat %>% 
  select(-lat, -lon)

save(habdat, file = 'data/habdat.RData', compress = 'xz')
save(habstat, file = 'data/habstat.RData', compress = 'xz')
```

Habitat restoration projects:
```{r}
head(habdat)
```
Locations of habitat restoration projects:
```{r}
head(habstat)
```